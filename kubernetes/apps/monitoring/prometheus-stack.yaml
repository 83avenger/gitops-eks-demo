---
# kube-prometheus-stack: Prometheus + Grafana + AlertManager + node-exporter
apiVersion: helm.toolkit.fluxcd.io/v2beta1  
kind: HelmRelease
# NOTE: If using ArgoCD (not Flux), use the Helm values in the ArgoCD Application
# This file is for reference â€” actual deployment via argocd/apps/platform-apps.yaml

# ---------------------------------------------------------------
# Prometheus Stack Values Reference
# ---------------------------------------------------------------
# Use these values when deploying via ArgoCD Helm application:

# prometheus:
#   prometheusSpec:
#     retention: 15d
#     retentionSize: 40GB
#     storageSpec:
#       volumeClaimTemplate:
#         spec:
#           storageClassName: gp3
#           accessModes: ["ReadWriteOnce"]
#           resources:
#             requests:
#               storage: 50Gi
#     serviceMonitorSelectorNilUsesHelmValues: false
#     serviceMonitorSelector: {}
#     podMonitorSelector: {}
#     resources:
#       requests:
#         cpu: 500m
#         memory: 1Gi
#       limits:
#         cpu: 2000m
#         memory: 4Gi
#
# alertmanager:
#   alertmanagerSpec:
#     storage:
#       volumeClaimTemplate:
#         spec:
#           storageClassName: gp3
#           accessModes: ["ReadWriteOnce"]
#           resources:
#             requests:
#               storage: 10Gi
#
# grafana:
#   adminPassword: "${GRAFANA_ADMIN_PASSWORD}"  # from External Secret
#   persistence:
#     enabled: true
#     storageClassName: gp3
#     size: 10Gi
#   ingress:
#     enabled: true
#     ingressClassName: alb
#     annotations:
#       alb.ingress.kubernetes.io/scheme: internet-facing
#       alb.ingress.kubernetes.io/target-type: ip
#     hosts:
#       - grafana.YOUR_DOMAIN.com
#   additionalDataSources:
#     - name: Loki
#       type: loki
#       url: http://loki-gateway.monitoring.svc.cluster.local
#       access: proxy
#
# nodeExporter:
#   enabled: true
#
# kubeStateMetrics:
#   enabled: true
#
# defaultRules:
#   create: true
#   rules:
#     alertmanager: true
#     etcd: false      # managed EKS doesn't expose etcd
#     configReloaders: true
#     general: true
#     k8sContainerCpuUsageSecondsTotal: true
#     k8sContainerMemoryCache: true
#     k8sContainerMemoryRss: true
#     k8sPodOwner: true
#     kubeApiserverAvailability: true
#     kubeApiserverBurnrate: true
#     kubeApiserverHistogram: true
#     kubeApiserverSlos: true
#     kubeControllerManager: false  # managed EKS
#     kubelet: true
#     kubeProxy: false              # managed EKS
#     kubeSchedulerAlerting: false  # managed EKS
#     kubeStateMetrics: true
#     network: true
#     node: true
#     nodeExporterAlerting: true
#     nodeExporterRecording: true
#     prometheus: true
